<!DOCTYPE html>
<html lang="en">
	<head>
		
		
		<meta charset="utf-8">
		<meta http-equiv="X-UA-Compatible" content="IE=edge">
		<meta name="viewport" content="width=device-width, initial-scale=1.0">
		
		
		
		<link rel="shortcut icon" href="../../../img/favicon.ico">
		<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" />
		<title>6. Automate tasks with bash scripts - #DevopsTraineeProgram</title>
		<link href="../../../bootstrap/dist/css/bootstrap.min.css" rel="stylesheet">
		<link href="../../../css/font-awesome-5.12.2-all.min.css" rel="stylesheet">
		<link href="../../../css/base.css" rel="stylesheet">
		<link rel="stylesheet" href="../../../css/highlight-github.css">
		<script src="../../../bootstrap/dist/js/bootstrap.min.js"></script>
		<script src="../../../js/highlight.pack.js"></script>
		
		<script>
			var base_url = '../../..';
			var home_url = '../../../home';
			var is_outer_page = false;
			
			var pageToc = [
				{title: "Automate tasks with bash scripts", url: "#_top", children: [
						
				{title: "Getting started", url: "#_top", children: [
				]},
				{title: "Variables, Conditionals", url: "#variables-conditionals", children: [
				]},
				{title: "Variables", url: "#variables", children: [
				]},
				{title: "Conditionals", url: "#conditionals", children: [
				]},
				{title: "Example", url: "#example", children: [
				]},
				]},
				{title: "Resources", url: "#resources", children: [
				]},
			];

		</script>
		<script src="../../../js/base.js"></script> 
	</head>

	<body class="inner-page">
		

		<div class="container-fluid wm-page-content">
			<a name="_top" aria-hidden="true"></a>
			






<div class="row pt-2 pb-4">
	<div class="col-sm text-center text-sm-left">
		<a href="../day05-01/" class="btn btn-sm btn-outline-dark">
			<i class="fa fa-chevron-left" aria-hidden="true"></i>
			Previous
		</a>
		<a href="../day05-01/" class="btn btn-sm btn-link">
			6. Bonus Challenge - Automating our LAMP Setup
		</a>
	</div>
	

	
	<div class="col-sm text-center text-sm-right">
		<a href="../day06-02/" class="btn btn-sm btn-link">
			Dev workstation setup - All the pretty things
		</a>
		<a href="../day06-02/" class="btn btn-sm btn-outline-dark">
			Next
			<i class="fa fa-chevron-right" aria-hidden="true"></i>
		</a>
	</div>
	
</div>

			

			<h2 id="automate-tasks-with-bash-scripts">Automate tasks with bash scripts</h2>
<p>The shell that we are going to use today is the bash but we will cover another shell tomorrow when we dive into ZSH. </p>
<p>BASH - <strong>B</strong>ourne <strong>A</strong>gain <strong>Sh</strong>ell</p>
<p>We could almost dedicate a whole section of 7 days to shell scripting much like the programming languages, bash gives us the capability of working alongside other automation tools to get things done. </p>
<p>I still speak to a lot of people where they have set up some complex shell scripts to make something happen and they rely on this script for some of the most important things in the business, I am not saying we need to understand shell/bash scripting for this purpose, this is not the way. But we should learn shell/bash scripting to work alongside our automation tools and for ad-hoc tasks. </p>
<p>An example of this that we have used in this section could be the VAGRANTFILE we used to create our VM, we could wrap this into a simple bash script that deleted and renewed this every Monday morning so that we have a fresh copy of our Linux VM every week, we could also add all the software stack that we need on said Linux machine and so on all through this one bash script. </p>
<p>I think another thing I am at least hearing is that hands-on scripting questions are becoming more and more apparent in all lines of interviews. </p>
<h3 id="getting-started">Getting started</h3>
<p>As with a lot of things we are covering in this whole 90 days, the only real way to learn is through doing. Hands-on experience is going to help soak all of this into your muscle memory. </p>
<p>First of all, we are going to need a text editor. On previous section we covered probably the two most common text editors and a little on how to use them. </p>
<p>Let's get straight into it and create our first shell script. </p>
<p><code>touch DevOpsTraineeProgram.sh</code></p>
<p>Followed by <code>nano DevOpsTraineeProgram.sh</code> this will open our new blank shell script in nano. Again you can choose your text editor of choice here. </p>
<p>The first line of all bash scripts will need to look something like this <code>#!/usr/bin/bash</code> this is the path to your bash binary. </p>
<p>You should however check this in the terminal by running <code>which bash</code> if you are not using Ubuntu then you might also try <code>whereis bash</code> from the terminal. </p>
<p>However, you may see other paths listed in already created shell scripts which could include: </p>
<ul>
<li><code>#!/bin/bash</code></li>
<li><code>#!/usr/bin/env bash</code></li>
</ul>
<p>In the next line in our script, I like to add a comment and add the purpose of the script or at least some information about me. You can do this by using the <code>#</code> This allows us to comment out particular lines in our code and provide descriptions for what the upcoming commands will be doing. I find the more notes the better for the user experience especially if you are sharing this. </p>
<p>Let's add a simple block of code to our script. </p>
<pre><code>mkdir DevOpsTraineeProgram
cd DevOpsTraineeProgram
touch Devops
ls 
</code></pre>
<p>You can then save this and exit your text editor, if we run our script with <code>./DevOpsTraineeProgram.sh</code> you should get a permission denied message. You can check the permissions of this file using the <code>ls -al</code> command and you can see highlighted we do not have executable rights on this file. </p>
<p>We can change this using <code>chmod +x DevOpsTraineeProgram.sh</code> and then you will see the <code>x</code> meaning we can now execute our script. </p>
<p>Now we can run our script again using <code>./DevOpsTraineeProgram.sh</code> after running the script has now created a new directory, changed into that directory and then created a new file. </p>
<p>Pretty basic stuff but you can start to see hopefully how this could be used to call on other tools as part of ways to make your life easier and automate things. </p>
<h3 id="variables-conditionals">Variables, Conditionals</h3>
<p>A lot of this section is really a repeat to what we covered when we were learning Golang but I think its worth us diving in here again. </p>
<ul>
<li>
<h3 id="variables">Variables</h3>
</li>
</ul>
<p>Variables enable us to define once a particular repeated term that is used throughout a potentially complex script. </p>
<p>To add a variable you simply add it like this to a clean line in your script. </p>
<p><code>challenge="DevOpsTraineeProgram"</code></p>
<p>This way when and where we use <code>$challenge</code> in our code, if we change the variable it will be reflected throughout.</p>
<p>If we now run our <code>sh</code> script you will see the printout that was added to our script. </p>
<p>We can also ask for user input that can set our variables using the following: </p>
<pre><code>echo &quot;Enter your name&quot;
read name
</code></pre>
<p>This would then define the input as the variable <code>$name</code> We could then use this later on. </p>
<ul>
<li>
<h3 id="conditionals">Conditionals</h3>
</li>
</ul>
<p>Maybe we want to find out who we have on our challenge and how many days they have completed, we can define this using <code>if</code> <code>if-else</code> <code>else-if</code> conditionals, this is what we have defined below in our script. </p>
<pre><code>#!/bin/bash
#  ___   ___  ____                   ___   __ ____              ___
# / _ \ / _ \|  _ \  __ _ _   _ ___ / _ \ / _|  _ \  _____   __/ _ \ _ __  ___
#| (_) | | | | | | |/ _` | | | / __| | | | |_| | | |/ _ \ \ / / | | | '_ \/ __|
# \__, | |_| | |_| | (_| | |_| \__ \ |_| |  _| |_| |  __/\ V /| |_| | |_) \__ \
#   /_/ \___/|____/ \__,_|\__, |___/\___/|_| |____/ \___| \_/  \___/| .__/|___/
#                         |___/                                     |_|
#
# This script is to demonstrate bash scripting!

# Variables to be defined

ChallengeName=#DevOpsTraineeProgram
TotalDays=90

# User Input

echo &quot;Enter Your Name&quot;
read name
echo &quot;Welcome $name to $ChallengeName&quot;
echo &quot;How Many Days of the $ChallengeName challenge have you completed?&quot;
read DaysCompleted

if [ $DaysCompleted -eq 90 ]
then
  echo &quot;You have finished, well done&quot;
elif [ $DaysCompleted -lt 90 ]
then
  echo &quot;Keep going you are doing great&quot;
else
  echo &quot;You have entered the wrong amount of days&quot;
fi
</code></pre>
<p>You can also see from the above that we are running some comparisons or checking values against each other to move on to the next stage. We have different options here worth noting. </p>
<ul>
<li><code>eq</code> - if the two values are equal will return TRUE</li>
<li><code>ne</code> - if the two values are not equal will return TRUE</li>
<li><code>gt</code> - if the first value is greater than the second value will return TRUE</li>
<li><code>ge</code> - if the first value is greater than or equal to the second value will return TRUE</li>
<li><code>lt</code> - if the first value is less than the second value will return TRUE</li>
<li><code>le</code> - if the first value is less than or equal to the second value will return TRUE</li>
</ul>
<p>We might also use bash scripting to determine information about files and folders, this is known as file conditions. </p>
<ul>
<li><code>-d file</code> True if the file is a directory</li>
<li><code>-e file</code> True if the file exists</li>
<li><code>-f file</code> True if the provided string is a file </li>
<li><code>g file</code> True if the group id is set on a file</li>
<li><code>-r file</code> True if the file is readable</li>
<li><code>-s file</code> True if the file has a non-zero size</li>
</ul>
<pre><code>FILE=&quot;DevOpsTraineeProgram.txt&quot;
if [ -f &quot;$FILE&quot; ]
then 
  echo &quot;$FILE is a file&quot;
else 
  echo &quot;$FILE is not a file&quot;
fi
</code></pre>
<p>Providing we have that file still in our directory we should get the first echo command back. But if we remove that file then we should get the second echo command. </p>
<p>You can hopefully see how this can be used to save you time when searching through a system for specific items. </p>
<p>There's this useful GitHub repository that has what seems to have an endless amount of scripts <a href="https://github.com/HariSekhon/DevOps-Bash-tools/blob/master/README.md">DevOps Bash Tools</a>.</p>
<h3 id="example">Example</h3>
<p><strong>Scenario</strong>: We have our company called "DevOpsTraineeProgram" and we have been running a while and now it is time to expand the team from 1 person to lots more over the coming weeks, I am the only one so far that knows the onboarding process so we want to reduce that bottleneck by automating some of these tasks. </p>
<p><strong>Requirements</strong>: 
- A user can be passed in as a command line argument. 
- A user is created with the name of command line argument. 
- A password can be parsed in as a command line argument. 
- The password is set for the user 
- A message of successful account creation is displayed. </p>
<p>Let's start with creating our shell script with <code>touch create_user.sh</code></p>
<p>Before we move on lets also make this executable using <code>chmod +x create_user.sh</code></p>
<p>then we can use <code>nano create_user.sh</code> to start editing our script for the scenario we have been set. </p>
<p>We can take a look at the first requirement "A user can be passed in as a command line argument" we can use the following </p>
<pre><code>#! /usr/bin/bash

#A user can be passed in as a command line argument
echo &quot;$1&quot;
</code></pre>
<p>Go ahead and run this using <code>./create_user.sh Name</code> replace Name with your name when you run the script. </p>
<p>Next up we can take that second requirement "A user is created with the name of command line argument" this can be done with the <code>useradd</code> command. The <code>-m</code> option is to create the user home directory as /home/username</p>
<pre><code>#! /usr/bin/bash

#A user can be passed in as a command line argument
echo &quot;$1 user account being created.&quot;

#A user is created with the name of command line argument
sudo useradd -m &quot;$1&quot;

</code></pre>
<p>Warning: If you do not provide a user account name then it will error as we have not filled the variable <code>$1</code></p>
<p>We can then check this account has been created with the <code>awk -F: '{ print $1}' /etc/passwd</code> command. </p>
<p>Our next requirement is "A password can be parsed in as a command line argument." First of all we are not going to ever do this in production it is more for us to work through a list of requirements in the lab to understand. </p>
<pre><code>#! /usr/bin/bash

#A user can be passed in as a command line argument
echo &quot;$1 user account being created.&quot;

#A user is created with the name of command line argument
sudo useradd -m &quot;$1&quot;

#A password can be parsed in as a command line argument.
sudo chpasswd &lt;&lt;&lt; &quot;$1&quot;:&quot;$2&quot;
</code></pre>
<p>If we then run this script with the two parameters <code>./create_user.sh DevOpsTraineeProgram password</code></p>
<p>You can see from the below image that we executed our script it created our user and password and then we manually jumped into that user and confirmed with the <code>whoami</code> command. </p>
<p>The final requirement is "A message of successful account creation is displayed." We actually already have this in the top line of our code and we can see on the above screen shot that we have <code>DevOpsTraineeProgram user account being created</code> is shown. This was left from our testing with the <code>$1</code> parameter. </p>
<p>Now this script can be used to quickly onboard and set up new users on to our Linux systems. But maybe instead of a few of the historic people having to work through this and then having to get other people their new usernames or passwords we could add some user input that we have previously covered earlier on to capture our variables. </p>
<pre><code>#! /usr/bin/bash

echo &quot;What is your intended username?&quot;
read  username
echo &quot;What is your password&quot;
read  password

#A user can be passed in as a command line argument
echo &quot;$username user account being created.&quot;

#A user is created with the name of command line argument
sudo useradd -m $username

#A password can be parsed in as a command line argument.
sudo chpasswd &lt;&lt;&lt; $username:$password
</code></pre>
<p>Just to finish this off maybe we do want to output a successful output to say that our new user account has finished being created.</p>
<p>One thing I did notice was that we are displaying the password on our input we can hide this by using the <code>-s</code> flag in the line of code <code>read -s password</code></p>
<p>If you do want to delete the user you have created for lab purposes then you can do that with <code>sudo userdel test_user</code></p>
<p>This isn't something that you'll create in your day to day but it is something that will give you an insight on the flexibility of what you could use shell scripting for. </p>
<p>Think about any repeatable tasks that you do every day or week or month and how could you better automate that, first option is likely going to be using a bash script before moving into more complex territory. </p>
<h2 id="resources">Resources</h2>
<ul>
<li><a href="https://www.youtube.com/watch?v=I4EWvMFj37g">Bash in 100 seconds</a></li>
<li>
<p><a href="https://www.youtube.com/watch?v=7qd5sqazD7k">BASH scripting will change your life - NetworkChuck</a></p>
</li>
<li>
<p><a href="https://www.youtube.com/watch?v=TPRSJbtfK4M">Bash script with practical examples - Full Course</a></p>
</li>
<li><a href="https://remmina.org/">Client SSH GUI - Remmina</a></li>
<li><a href="https://www.youtube.com/watch?v=2QXkrLVsRmk">The Beginner's guide to SSH</a></li>
<li><a href="https://www.youtube.com/watch?v=-txKSRn0qeA">Vim in 100 Seconds</a></li>
<li><a href="https://www.youtube.com/watch?v=IiwGbcd8S7I">Vim tutorial</a></li>
</ul>
<p>See you in the <a href="../day06-02/">Next Section</a>.</p>

			<br>
			






<div class="row pt-2 pb-4">
	<div class="col-sm text-center text-sm-left">
		<a href="../day05-01/" class="btn btn-sm btn-outline-dark">
			<i class="fa fa-chevron-left" aria-hidden="true"></i>
			Previous
		</a>
		<a href="../day05-01/" class="btn btn-sm btn-link">
			6. Bonus Challenge - Automating our LAMP Setup
		</a>
	</div>
	

	
	<div class="col-sm text-center text-sm-right">
		<a href="../day06-02/" class="btn btn-sm btn-link">
			Dev workstation setup - All the pretty things
		</a>
		<a href="../day06-02/" class="btn btn-sm btn-outline-dark">
			Next
			<i class="fa fa-chevron-right" aria-hidden="true"></i>
		</a>
	</div>
	
</div>

			<br>
		</div>

		<footer class="container-fluid wm-page-content text-center small">
			<details>
				<summary>
					Documentation built with <a href="http://www.mkdocs.org/" target="_blank">MkDocs</a> using  <a href="https://github.com/Siphalor/mkdocs-custommill" target="_blank">CustomMill</a>.
				</summary>
				<h6 class="mt-2">Additional Licenses</h6>
				<ul><li>
						CustomMill is based on the <a href="https://github.com/gristlabs/mkdocs-windmill" target="_blank">Windmill</a> theme by Grist Labs, licensed under the <a href="https://github.com/gristlabs/mkdocs-windmill/blob/master/LICENSE" target="_blank">MIT License</a>
					</li>
					<li>
						CustomMill includes <a href="https://getbootstrap.com" target="_blank">Bootstrap</a> version 5.1.3. This is available under the <a href="https://github.com/twbs/bootstrap/blob/master/LICENSE" target="_blank">MIT License</a>.
					</li>
					<li>
						Syntax highlighting is implemented via <a href="https://highlightjs.org" target="_blank">highlight.js</a> licensed under the BSD 3-Clause License and the included github styling made by Vasily Polovnyov.
					</li>
					<li>
						Icons on this site are from <a href="https://fontawesome.com/" target="_blank">Font Awesome</a> which is licensed under the <a href="https://fontawesome.com/license/free" target="_blank">Font Awesome Free License</a>.
					</li></ul>
				<p>Built at 2022-05-09 14:06:26 UTC</p>
			</details>
		</footer>

		
	</body>
</html>